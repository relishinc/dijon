<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: component/Rotateable.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: component/Rotateable.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module Dijon */
var Rotateable = function(iconKey, iconFrame, iconAngle, padding, iconOffset) {
    this.name = 'Rotateable';

    this._iconAdded = false;
    this._iconKey = iconKey;
    this._iconFrame = iconFrame;
    this._iconAngle = iconAngle || 0;
    this._padding = typeof padding === 'undefined' ? 100 : padding;
    this._iconOffset = typeof iconOffset === 'undefined' ? {
        x: 0,
        y: 0
    } : iconOffset;
};

Rotateable.prototype = {
    constructor: Rotateable,

    setOwner: function(owner) {
        this.owner = owner;
        this.game = this.owner.game;
    },

    init: function() {
        if (this.game.device.desktop) {
            this.owner.inputEnabled = true;
            this.owner.input.useHandCursor = true;
            this.owner.events.onInputOver.add(this._onRollover, this);
            this.owner.events.onInputOut.add(this._onRollout, this);
        }

        this.owner.events.onInputDown.add(this._onPress, this);
    },

    buildInterface: function() {

    },

    update: function() {
        if (this.owner.parent &amp;&amp; !this._iconAdded)
            this._init();
        if (this._hovered &amp;&amp; this._inRotateArea()) {
            if (!this._iconShowing)
                this._showIcon();
        } else if (this._rotating) {
            var angle = Math.atan2(this.game.input.activePointer.y - this._initialPosition.y, this.game.input.activePointer.x - this._initialPosition.x) * 180 / Math.PI;
            this.owner.angle = this._initialAngle + angle;
        }

        if (typeof this.icon !== 'undefined') {
            this.icon.position.set(this.game.input.activePointer.x + this._iconOffset.x, this.game.input.activePointer.y + this._iconOffset.y);
        }
    },

    destroy: function() {
        this.icon.parent.remove(this.icon, true, true);
        this.owner.events.onInputOver.remove(this._onRollover, this);
        this.owner.events.onInputOut.remove(this._onRollout, this);
        this.owner.events.onInputDown.add(this._onPress, this);
        this.game.input.onUp.remove(this._onRelease, this);
        this.owner.hitArea = null;
    },

    _createHitArea: function() {
        var bounds = this.owner.getBounds();
        this.owner.hitArea = new Phaser.Rectangle(-this._padding, -this._padding, bounds.width + this._padding * 2, bounds.height + this._padding * 2);
    },

    _init: function() {
        this._createHitArea();
        this._iconAdded = true;
        this.icon = this.owner.parent.addChild(this.game.add.image(0, 0, this._iconKey, this._iconFrame));
        this.icon.centerPivot();

        this.icon.alpha = 0;
        this.icon.visible = false;

        this.showTween = this.game.add.tween(this.icon).to({
            alpha: 1
        }, 300, Phaser.Easing.Quadratic.Out);

        this.hideTween = this.game.add.tween(this.icon).to({
            alpha: 0
        }, 200, Phaser.Easing.Quadratic.In);

        this.hideTween.onComplete.add(this._makeIconInvisible, this);
    },

    _inRotateArea: function() {
        var bounds;
        if (this.game.device.desktop) {
            bounds = this.owner.getBounds();
            if (this.game.input.activePointer.x &lt; bounds.left &amp;&amp; this.game.input.activePointer.x > bounds.left - this._padding &amp;&amp; this.game.input.activePointer.y &lt; bounds.top &amp;&amp; this.game.input.activePointer.y > bounds.top - this._padding) {
                return true;
            }
        }
    },

    _onRollover: function() {
        this._hovered = true;
    },

    _onRollout: function() {
        this._hovered = false;
        this._hideIcon();
    },

    _showIcon: function() {
        if (this._pressed)
            return;
        this._iconShowing = true;
        this._initialAngle = -this.owner.angle;
        this.showTween.start();
        this.icon.visible = true;
    },

    _hideIcon: function() {
        if (this._pressed)
            return;
        this._iconShowing = false;
        this.hideTween.start();
    },

    _onPress: function() {
        this._pressed = true;

        this._showIcon();

        this._initialPosition = {
            x: this.game.input.activePointer.x,
            y: this.game.input.activePointer.y
        };

        if (this.game.device.desktop &amp;&amp; this._inRotateArea()) {
            this._rotating = true;
            this.game.input.onUp.addOnce(this._onRelease, this);
        }

    },

    _onRelease: function() {
        this._pressed = false;

        this._rotating = false;
        this._hovered = false;

        this._createHitArea();
        this._hideIcon();
    },

    _makeIconInvisible: function() {
        this.icon.visible = false;
    }
};

module.exports = Rotateable;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-Dijon.html">Dijon</a></li></ul><h3>Classes</h3><ul><li><a href="AssetManager.html">AssetManager</a></li><li><a href="AudioManager.html">AudioManager</a></li><li><a href="BaseComponent.html">BaseComponent</a></li><li><a href="BaseState.html">BaseState</a></li><li><a href="CopyModel.html">CopyModel</a></li><li><a href="InvisibleButton.html">InvisibleButton</a></li><li><a href="Model.html">Model</a></li><li><a href="SaveManager.html">SaveManager</a></li><li><a href="SequenceManager.html">SequenceManager</a></li><li><a href="TransitionManager.html">TransitionManager</a></li><li><a href="UIGroup.html">UIGroup</a></li><li><a href="UISprite.html">UISprite</a></li><li><a href="UIText.html">UIText</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Fri Jun 19 2015 15:28:19 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
